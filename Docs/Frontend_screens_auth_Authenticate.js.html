<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Frontend/screens/auth/Authenticate.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/NaveFlactem/BlitzBuyr" target="_blank" class="menu-item" id="repository" >Github repo</a></h2><h3>Modules</h3><ul><li><a href="module-API_Accounts.html">API/Accounts</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-API_Accounts.html#~authenticateUser">authenticateUser</a></li><li data-type='method' style='display: none;'><a href="module-API_Accounts.html#~getAccounts">getAccounts</a></li><li data-type='method' style='display: none;'><a href="module-API_Accounts.html#~handleDeleteAccounts">handleDeleteAccounts</a></li><li data-type='method' style='display: none;'><a href="module-API_Accounts.html#~handleLoginRequest">handleLoginRequest</a></li><li data-type='method' style='display: none;'><a href="module-API_Accounts.html#~handleRegistrationRequest">handleRegistrationRequest</a></li></ul></li><li><a href="module-API_Listings.html">API/Listings</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-API_Listings.html#~createListing">createListing</a></li><li data-type='method' style='display: none;'><a href="module-API_Listings.html#~encodeImageToBlurhash">encodeImageToBlurhash</a></li><li data-type='method' style='display: none;'><a href="module-API_Listings.html#~getImages">getImages</a></li><li data-type='method' style='display: none;'><a href="module-API_Listings.html#~getListings">getListings</a></li><li data-type='method' style='display: none;'><a href="module-API_Listings.html#~handleDeleteImages">handleDeleteImages</a></li><li data-type='method' style='display: none;'><a href="module-API_Listings.html#~handleDeleteListing">handleDeleteListing</a></li><li data-type='method' style='display: none;'><a href="module-API_Listings.html#~handleDeleteListings">handleDeleteListings</a></li></ul></li><li><a href="module-API_Profile.html">API/Profile</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-API_Profile.html#~deleteAllLikes">deleteAllLikes</a></li><li data-type='method' style='display: none;'><a href="module-API_Profile.html#~deleteRating">deleteRating</a></li><li data-type='method' style='display: none;'><a href="module-API_Profile.html#~getLikes">getLikes</a></li><li data-type='method' style='display: none;'><a href="module-API_Profile.html#~getProfilePicture">getProfilePicture</a></li><li data-type='method' style='display: none;'><a href="module-API_Profile.html#~getRatings">getRatings</a></li><li data-type='method' style='display: none;'><a href="module-API_Profile.html#~getUserProfile">getUserProfile</a></li><li data-type='method' style='display: none;'><a href="module-API_Profile.html#~handleLike">handleLike</a></li><li data-type='method' style='display: none;'><a href="module-API_Profile.html#~handleUnlike">handleUnlike</a></li><li data-type='method' style='display: none;'><a href="module-API_Profile.html#~rateUser">rateUser</a></li><li data-type='method' style='display: none;'><a href="module-API_Profile.html#~updateContactInfo">updateContactInfo</a></li><li data-type='method' style='display: none;'><a href="module-API_Profile.html#~updateProfile">updateProfile</a></li></ul></li><li><a href="module-Database.html">Database</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Database.html#~areTableDefinitionsEqual">areTableDefinitionsEqual</a></li><li data-type='method' style='display: none;'><a href="module-Database.html#~createOrUpdateTable">createOrUpdateTable</a></li><li data-type='method' style='display: none;'><a href="module-Database.html#~createTables">createTables</a></li><li data-type='method' style='display: none;'><a href="module-Database.html#~extractColumnsFromDefinition">extractColumnsFromDefinition</a></li></ul></li><li><a href="module-Server.html">Server</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-Server.html#~getRoot">getRoot</a></li><li data-type='method' style='display: none;'><a href="module-Server.html#~requestLogger">requestLogger</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="Authenticate.html">Authenticate</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Authenticate.html#.AuthenticateScreen">AuthenticateScreen</a></li><li data-type='method' style='display: none;'><a href="Authenticate.html#.checkStoredCredentials">checkStoredCredentials</a></li><li data-type='method' style='display: none;'><a href="Authenticate.html#.clearStoredCredentials">clearStoredCredentials</a></li><li data-type='method' style='display: none;'><a href="Authenticate.html#.getStoredPassword">getStoredPassword</a></li><li data-type='method' style='display: none;'><a href="Authenticate.html#.getStoredUsername">getStoredUsername</a></li><li data-type='method' style='display: none;'><a href="Authenticate.html#.loadSettings">loadSettings</a></li><li data-type='method' style='display: none;'><a href="Authenticate.html#.setStoredCredentials">setStoredCredentials</a></li></ul></li><li><a href="ChangePassword.html">ChangePassword</a></li><li><a href="Components.html">Components</a><ul class='members'><li data-type='member' style='display: none;'><a href="Components.html#.onGestureEvent">onGestureEvent</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="Components.html#.NoWifi">NoWifi</a></li><li data-type='method' style='display: none;'><a href="Components.html#.clearSelections">clearSelections</a></li><li data-type='method' style='display: none;'><a href="Components.html#.handleConditionPress">handleConditionPress</a></li><li data-type='method' style='display: none;'><a href="Components.html#.handleCurrencyPress">handleCurrencyPress</a></li><li data-type='method' style='display: none;'><a href="Components.html#.handleTagPress">handleTagPress</a></li><li data-type='method' style='display: none;'><a href="Components.html#.handleTransactionPress">handleTransactionPress</a></li></ul></li><li><a href="CreateAccount.html">CreateAccount</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CreateAccount.html#.CreateAccountScreen">CreateAccountScreen</a></li><li data-type='method' style='display: none;'><a href="CreateAccount.html#.handleCreateAccount">handleCreateAccount</a></li><li data-type='method' style='display: none;'><a href="CreateAccount.html#.handlePasswordChange">handlePasswordChange</a></li></ul></li><li><a href="global.html#CreateListing">CreateListing</a><ul class='methods'><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.checkValidListing">checkValidListing</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.destructor">destructor</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.getPermissionAsync">getPermissionAsync</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.groupTagsIntoRows">groupTagsIntoRows</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.handleCreateListing">handleCreateListing</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.handleDeletePhoto">handleDeletePhoto</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.handleDragRelease">handleDragRelease</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.handleDragStart">handleDragStart</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.handlePriceChange">handlePriceChange</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.handleTagPress">handleTagPress</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.manipulateImage">manipulateImage</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.processImage">processImage</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.processSelectedImages">processSelectedImages</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.render_item">render_item</a></li><li data-type='method' style='display: none;'><a href="global.html#CreateListing#.showModal">showModal</a></li></ul></li><li><a href="EditContactInfo.html">EditContactInfo</a><ul class='methods'><li data-type='method' style='display: none;'><a href="EditContactInfo.html#.EditContactInfo">EditContactInfo</a></li><li data-type='method' style='display: none;'><a href="EditContactInfo.html#.handleInputChange">handleInputChange</a></li></ul></li><li><a href="EditProfile.html">EditProfile</a><ul class='methods'><li data-type='method' style='display: none;'><a href="EditProfile.html#.EditProfileScreen">EditProfileScreen</a></li><li data-type='method' style='display: none;'><a href="EditProfile.html#.confirmDeletion">confirmDeletion</a></li><li data-type='method' style='display: none;'><a href="EditProfile.html#.deleteAccount">deleteAccount</a></li><li data-type='method' style='display: none;'><a href="EditProfile.html#.handleCoverImageSelection">handleCoverImageSelection</a></li><li data-type='method' style='display: none;'><a href="EditProfile.html#.handleProfileImageSelection">handleProfileImageSelection</a></li><li data-type='method' style='display: none;'><a href="EditProfile.html#.saveChanges">saveChanges</a></li><li data-type='method' style='display: none;'><a href="EditProfile.html#.togglePasswordVisibility">togglePasswordVisibility</a></li></ul></li><li><a href="HomeScreen.html">HomeScreen</a><ul class='members'><li data-type='member' style='display: none;'><a href="HomeScreen.html#.HomeScreen">HomeScreen</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="HomeScreen.html#.fetchListingsAsync">fetchListingsAsync</a></li><li data-type='method' style='display: none;'><a href="HomeScreen.html#.getUserLocation">getUserLocation</a></li><li data-type='method' style='display: none;'><a href="HomeScreen.html#.handleInnerScrolling">handleInnerScrolling</a></li><li data-type='method' style='display: none;'><a href="HomeScreen.html#.handleInnerScrollingEnd">handleInnerScrollingEnd</a></li><li data-type='method' style='display: none;'><a href="HomeScreen.html#.handleLocationPress">handleLocationPress</a></li><li data-type='method' style='display: none;'><a href="HomeScreen.html#.onRefresh">onRefresh</a></li><li data-type='method' style='display: none;'><a href="HomeScreen.html#.onScroll">onScroll</a></li><li data-type='method' style='display: none;'><a href="HomeScreen.html#.retryButtonHandler">retryButtonHandler</a></li><li data-type='method' style='display: none;'><a href="HomeScreen.html#.toggleTagDrawer">toggleTagDrawer</a></li></ul></li><li><a href="Login.html">Login</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Login.html#.LoginScreen">LoginScreen</a></li><li data-type='method' style='display: none;'><a href="Login.html#.handleCreateAccount">handleCreateAccount</a></li><li data-type='method' style='display: none;'><a href="Login.html#.handleLogin">handleLogin</a></li></ul></li><li><a href="Networking.html">Networking</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Networking.html#.fetchListings">fetchListings</a></li><li data-type='method' style='display: none;'><a href="Networking.html#.handleDeleteAccount">handleDeleteAccount</a></li><li data-type='method' style='display: none;'><a href="Networking.html#.handleDeleteAccount">handleDeleteAccount</a></li><li data-type='method' style='display: none;'><a href="Networking.html#.handleLike">handleLike</a></li><li data-type='method' style='display: none;'><a href="Networking.html#.handleListingCreation">handleListingCreation</a></li><li data-type='method' style='display: none;'><a href="Networking.html#.saveContactInfo">saveContactInfo</a></li><li data-type='method' style='display: none;'><a href="Networking.html#.saveProfileInfo">saveProfileInfo</a></li></ul></li><li><a href="Rating.html">Rating</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Rating.html#.RatingScreen">RatingScreen</a></li><li data-type='method' style='display: none;'><a href="Rating.html#.handleRating">handleRating</a></li><li data-type='method' style='display: none;'><a href="Rating.html#.handleSubmitRating">handleSubmitRating</a></li><li data-type='method' style='display: none;'><a href="Rating.html#.renderStars">renderStars</a></li></ul></li><li><a href="Utilities.html">Utilities</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Utilities.html#.calculateTimeSince">calculateTimeSince</a></li><li data-type='method' style='display: none;'><a href="Utilities.html#.getLocationWithRetry">getLocationWithRetry</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#TagDrawer">TagDrawer</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">Frontend/screens/auth/Authenticate.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @namespace Authenticate
 * @description Headless authentication screen which uses the device cache to automatically login into BlitzBuyer
 */
import { Asset } from 'expo-asset';
import * as SecureStore from 'expo-secure-store';
import { useEffect } from 'react';
import { StyleSheet, View } from 'react-native';
import { checkListingExpiration, scheduleNotification } from '../../components/Notifications.js';
import { serverIp } from '../../config.js';
import Colors from '../../constants/Colors';
import * as Settings from '../../hooks/UserSettings.js';
import { useThemeContext } from '../../components/visuals/ThemeProvider.js';
import { getThemedStyles } from '../../constants/Styles.js';

const assetsToPreload = [
  require('../../assets/blitzbuyr_name_logo.png'),
  require('../../assets/blitzbuyr_name_logo.png'),
  require('../../assets/blitzbuyr_name_transparent_horizontal.png'),
  require('../../assets/blitzbuyr_name_transparent.png'),
  require('../../assets/blitzbuyr_name.png'),
  require('../../assets/icon_background_transparent_upright.png'),
  require('../../assets/icon_background_transparent_upright_mini.png'),
  require('../../assets/icon_background_transparent.png'),
  require('../../assets/icon_transparent_background_filled_upright.png'),
  require('../../assets/icon_transparent_background_filled_upright_mini.png'),
  require('../../assets/icon_transparent_background_filled.png'),
  require('../../assets/icon_transparent.png'),
  require('../../assets/icon.png'),
  require('../../assets/no_wifi_icon_transparent.png'),
  require('../../assets/card_background.png'),
];

let storedUsername;
let storedPassword;

/**
 * Returns the username stored in the device cache.
 * @function
 * @name getStoredUsername
 * @returns {string} The stored username.
 * @memberof Authenticate
 */
const getStoredUsername = () => storedUsername;

/**
 * Returns the password stored in the device cache.
 * @function
 * @name getStoredPassword
 * @returns {string} The stored password.
 * @memberof Authenticate
 */
const getStoredPassword = () => storedPassword;

/**
 * Sets the stored credentials in the cache.
 * @function
 * @name setStoredCredentials
 * @param {string} username - The username to be stored.
 * @param {string} password - The password to be stored.
 * @returns {Promise&lt;void>}
 * @memberof Authenticate
 */
const setStoredCredentials = async (username, password) => {
  storedUsername = username;
  storedPassword = password;
  await SecureStore.setItemAsync('username', username);
  await SecureStore.setItemAsync('password', password);
};

/**
 * Clears the stored credentials.
 * @function
 * @name clearStoredCredentials
 * @returns {Promise&lt;void>}
 * @memberof Authenticate
 */
const clearStoredCredentials = async () => {
  try {
    await SecureStore.deleteItemAsync('username');
    await SecureStore.deleteItemAsync('password');
    console.log('Stored credentials cleared.');
  } catch (error) {
    console.error('Error clearing stored credentials:', error);
  }
};

/**
 * Component for authentication screen.
 * @function
 * @name AuthenticateScreen
 * @param {Object} props - React component props.
 * @param {Object} props.navigation - Navigation object for navigating between screens.
 * @returns {JSX.Element} The authentication screen component.
 * @memberof Authenticate
 */
const AuthenticateScreen = ({ navigation }) => {
  useEffect(() => {
    // Load and cache the assets when the component mounts
    async function loadAssetsAsync() {
      const assetPromises = assetsToPreload.map((asset) =>
        Asset.fromModule(asset).downloadAsync(),
      );
      await Promise.all(assetPromises);
    }

    loadAssetsAsync();
  }, []);

  useEffect(() => {
    /**
     * Loads user settings.
     * @function
     * @name loadSettings
     * @returns {Promise&lt;void>}
     * @memberof Authenticate
     */
    const loadSettings = async () => {
      const settings = await Settings.getUserSettings();
      console.log('User settings:', settings);
    };

    /**
     * Checks stored credentials and performs login.
     * @function
     * @name checkStoredCredentials
     * @returns {Promise&lt;void>}
     * @memberof Authenticate
     */
    const checkStoredCredentials = async () => {
      storedUsername = await SecureStore.getItemAsync('username');
      storedPassword = await SecureStore.getItemAsync('password');

      if (storedUsername &amp;&amp; storedPassword) {
        // Stored credentials exist, use them for login
        const loginData = {
          username: storedUsername,
          password: storedPassword,
        };

        const response = await fetch(`${serverIp}/api/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(loginData),
        });

        let responseData = await response.json();

        if (response.status &lt;= 201) {
          loadSettings();
          console.log('Response data:', responseData);
          navigation.navigate('BottomNavOverlay');
          checkListingExpiration();
          scheduleNotification();
        } else {
          navigation.navigate('Login');
        }
      } else {
        navigation.navigate('Login');
      }
    };

    checkStoredCredentials();
  }, []);

  const styles = getThemedStyles(useThemeContext().theme).Authentication;

  return &lt;View style={styles.container}>&lt;/View>;
};

export {
  getStoredUsername,
  getStoredPassword,
  setStoredCredentials,
  clearStoredCredentials,
};
export default AuthenticateScreen;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Sat Dec 02 2023 12:43:29 GMT-0800 (Pacific Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
